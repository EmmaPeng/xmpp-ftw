<html>
    <head>
        <script type="text/javascript" src="/socket.io/socket.io.js"></script>
        <script type="text/javascript" src="/client.js"></script>
        <style>
            pre { 
                border: 1px solid #000;
                margin: 5px;
                background-color: #ddd;
                padding-top: 15px;
            }
            a { 
                text-decoration: none;
            }
            .subtitle {
                font-weight: bold;
                font-size: 1.6em;
            }
        </style>
        <script src="//code.jquery.com/jquery-1.9.1.min.js"></script>
        <script type="text/javascript">
        $(document).ready(function() {
            $("h2, h3, h4").each(function(i) {
                var current = $(this);
                current.attr("id", "title" + i);
                var indent = ''
                if (current[0].nodeName == 'H3') indent = '&nbsp;&nbsp;&nbsp;&nbsp;'
                if (current[0].nodeName == 'H4') indent = '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'
                $("#toc").append(indent + "<a id='link" + i + "' href='#title" +
                    i + "' title='" + current.attr("tagName") + "'>" + 
                    current.html() + "</a><br/>")
                current.append(' <a href="#top">&uarr;</a>')
            });
            $("#toc").before('<h2><a name="top"></a>Contents</h2>')
        })
        </script>
    </head>
    <body>
        <h1>XMPP For The Web/Win ::: XMPP-FTW</h1>
        <p class="subtitle">Welcome to XMPP over websockets using JSON</p>
      
        <div id="toc"></div>
        
        <h2>JIDs</h2>
        
        <p>JIDs are always sent as an object as follows:</p>
        <pre>
        { 
            node: 'user',
            domain: 'example.com',
            resource: 'lounge'
        }
        </pre>
        
        <h2>Authentication</h2>
 
        <h3>Login</h3>
        <pre>
        socket.emit('xmpp.login', {jid: 'test@example.com', password: 'password'})
        </pre>
        <p>You can also add an optional parameter of <i>resource</i>, if not provided the XMPP 
           server will add this automatically.</p>

        <h2>Messaging</h2>

        <h3>Send a message</h3>
        <pre>
        socket.emit('xmpp.chat.message', {to: 'other@example.com', message: 'Hello world'})
        </pre>

        <h3>Receive a chat message</h3>
        <pre>
        socket.on('xmpp.chat.message', function(data) {
            console.log('Got message from ' + data.from)
            console.log('Content was: ' + data.content)
        })
        </pre>

        <h2>Presence</h2>

        <h3>Set presence</h3>
        <pre>
        socket.emit('xmpp.presence', {show: 'online', status: "I'm using this script!", priority: 10})
        </pre>
        <p>Each of the parameters for presence are <i>optional</i>.</p>
        
        <h3>Receive presence</h3>
        <pre>
        socket.on('xmpp.presence', function(data) { 
            console.log(data); 
            /*
              { show: 'away', status: "I'm going away", priority: 10 }
              ...each of these are optional...
             */
        })
        </pre>
        
        <h3>Directed presence</h3>
        
        <pre>
        socket.emit('xmpp.presence.get', { to: 'user@example.com' })
        </pre>

        <h3>Go offline</h3>
        
        <pre>
        socket.emit('xmpp.presence.offline')
        </pre>
        
        <h3>Subscribe</h3>
        <p>Request to subsribe to a user</p>
        <pre>
        socket.emit('xmpp.presence.subscribe', {to: 'user@example.com' })
        </pre>
        
        <p>User requests to subscribe to your presence</p>
        <pre>
        socket.on('xmpp.presence.subscribe', function(data) {
            console.log(data);
            /* { 
                   from: 'user@example.com'
                   nick: 'Example user' // ...optional...
               } */
        })
        </pre>
        
        <p>Respond with subscribed or unsubscribed</p>
        <pre>
        socket.emit('xmpp.presence.subscribed', { to: 'user@example.com' })
        
        //   ..... or .....
        
        socket.emit('xmpp.presence.unsubscribed', { to: 'user@example.com' })
        </pre>
        
        <h2>Roster</h2>
        
        <h3>Add user to roster</h3>
        
        <pre>
        socket.emit(
            'xmpp.roster.add',
            {},
            function(reply) { 
                if (reply.error) console.log(reply.error);
            }
        )
        /* Data to send:
         * {
         *     jid: 'user@example.com',
         *     name: 'Example user',    // ...optional...
         *     group: 'example-users'   // ...optional...
         * }
         */
        </pre>
        
        <h3>Get</h3>
        
        <pre>
        socket.emit(
            'xmpp.roster.get',
            {},
            function(roster) { console.log('roster', roster)}
        )
        
        /* Data returns as array of objects, e.g.
         * [ {
         *      jid: { node: 'user', domain: 'example.com' },
         *      subscription: 'both',
         *      name: 'Example user',
         *      group: 'Buddies',
         *      [ ask = 'subscribe' ]
         * } ]
        </pre>
        
        <h3>New incoming Roster request</h3>
        
        <pre>
        socket.on('xmpp.roster.add', function(data) {
            console.log(data);
        })
        
        /*
         * {
         *      jid: { node: 'user', domain: 'example.com' },
         *      subscription: 'both',
         *      name: 'Example user',
         *      group: 'Buddies',
         *      [ ask = 'subscribe' ]
         * }
         */
        </pre>
        
        <h3>Add a user to a roster group</h3>
        
        <pre>
        socket.emit('xmpp.roster.group', { jid: 'user@example.com', group: 'buddies' })
        </pre>
        
        <h2>Multi-user chat (MUC) [XEP-0045]</h2>
        
        <h3>Join a room</h3>
        
        <pre>
        socket.emit('xmpp.muc.join', { room: 'jdev@conference.jabber.org', nick: 'MyNickname' })
        </pre>
        
        <h3>Receive room roster</h3>
        
        <pre>
        socket.on('xmpp.muc.roster', function(data) { console.log(data) })
        
        /* Note: You may receive many of these messages
         * {
         *     room: 'jdev@conference.jabber.org',
         *     nick: 'TheirNickname'
         * }
         */
        </pre>
         
        <h3>Receive a message</h3>
         
        <pre>
        socket.on('xmpp.muc.message', function(data) { console.log(data) })
        
        /*
         * {
         *     room: 'jdev@conference.jabber.org',
         *     nick: 'TheirNickname',
         *     content: 'Hello world!',
         *   [ timestamp: '2012-03-03T20:22:00Z', ]
         *   [ private: false ]
         * }
         */
        </pre>
        
        <h3>Send a message</h3>
        
        <pre>
        socket.emit(
            'xmpp.muc.message',
            {
                room: 'jdev@conference.jabber.org',
                content: 'Hello XMPP people!',
              [ to: 'TheirNickname' ]
            }
        </pre>
        <p>If 'to' is provided then message becomes a private message.</p>
        
        <h4>Leave a room</h4>
        
        <pre>
        socket.emit(
            'xmpp.muc.leave',
            {
                room: 'jdev@conference.jabber.org'
            }
        )
        </pre>
        
        <h3>Errors</h3>
        
        <h4>Message Errors</h4>
        
        <pre>
        socket.on('xmpp.muc.error', function(data) { console.log(data) })
        
        /*
         * {
         *     type: 'message',
         *     error: 'SERVICE-UNAVAILABLE'  // example only
         * }
         */
        </pre>
        <p>Code will attempt to grab the extended reason from the 
        '<abbr title="urn:ietf:params:xml:ns:xmpp-stanzas">xmpp-stanzas</abbr>' namespaced 
        element, otherwise it will grab the 'type' attribute from the error tag.</p>

        
        <% include ./ga %>
    </body>
</html
